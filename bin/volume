#!/bin/bash
# Volume control with wob overlay
# Usage: volume up|down|mute

SOCK="$XDG_RUNTIME_DIR/wob.sock"

case "$1" in
    up)
        wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%+
        ;;
    down)
        wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
        ;;
    mute)
        wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
        ;;
esac

# Get current volume and mute state, send to wob
vol=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | awk '{print int($2*100)}')
muted=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -q MUTED && echo 1 || echo 0)

if [ "$muted" = "1" ]; then
    echo "0" > "$SOCK"
else
    echo "$vol" > "$SOCK"
fi
